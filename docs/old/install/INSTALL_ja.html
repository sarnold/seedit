<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>























  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <meta content="text/html; charset=EUC-JP" http-equiv="content-type">






















  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <title>INSTALL</title>
</head>


<body>























<big><big><big>How to install SELinux Policy Editor</big></big></big>(Ver1.2)<br>

















2005. 08.30<br>























著：　中村　雄一 &lt;ynakam@gwu.edu&gt;<br>























<br>























これは,SELinux Policy Editor（Version1.2)のインストールドキュメントです。<br>












全てRPMパッケージからインストールすることができます。<br>







ここでは，RPMパッケージからインストールする方法を紹介しています。<br>












ソースからインストールする場合は、ソースファイル<br>







(seedit-converter, seedit-policy)の中のREADMEを参照して下さい。<br>












<br>












<big style="text-decoration: underline;"><big><a name="1"></a>1.
インストールの前に<br>






















</big></big><span style="text-decoration: underline;">(1)
何をインストールすればいいの？</span><br>






















&nbsp;SELinux Policy Editorは,　Simplified Policy(単純化ポリシ）とGUIから構成されています。<br>






















Simplified Policyのインストールは必須で,GUIはオプションです。<br>






















GUIはオプションですが,インストールすることでより簡単に使うことができます。<br>












なお，GUIの利用にはwebmin(www.webmin.com）が必要です。<br>






















<br>






















<span style="text-decoration: underline;">(2) 動作環境 </span><br>























Fedora Core 4, Turbo Linux10 Server, Asianux 2.0 で動作を確認しましたが,Fedora Core4が推奨です。<br>






















ただし,<span style="text-decoration: underline;">我々のツールは実験的なものであり,致命的バグを含む可能性</span>があります。<br>






















本ツールを使ったことによって生じた被害に対しては<span style="text-decoration: underline; font-weight: bold;">無保証</span>です。<br>






















ポリシーは工事中です。動作しないサービスもあります。<br>

















インストール後，「initrc_t」ドメインで動作しているサービスは，ポリシが用意されていないと考えてください。<br>













/etc/selinux/seedit/src/policy/simplified_policy<br>













ディレクトリを見れば何についてポリシが用意されているかが分かります。<br>





<br>




- 不要なサービスは止める<br>





不要なサービスは止めておくことをお奨めします。<br>





Fedora Core4の場合<br>





Fedora Core4では,不要なサービスを含め多くのサービスが動作しています。<br>





特にデフォルトで起動する以下のサービスに対するポリシは用意されていないので、止めておきましょう。<br>

Bluetooth cups cups-config-daemon gpm&nbsp;mDNSResponder messagebus netfs nifd nfslock portmap rpcgssd rpcidmapd<br>

 <br>

- Xについて<br>




以前のバージョンでは，Xをサポートしておらず，ランレベルは３にしていましたが，<br>




今回は，Xをサポートしていますので、ランレベル５でもOKです。<br>




ただし，FC4,TurboLinux10Serverでは設定を厳しくしており，<br>




sysadm_rになれるユーザ(デフォルトはroot)しかXでグラフィカルログインできません。<br>

<br>
&nbsp;<br>























<big style="text-decoration: underline;"><big><a name="2"></a>2. インストール方法</big></big><br>












2.1 必要なファイルを入手<br>

















まずは，必要なファイルをダウンロードします。<br>

















以下のファイルを<a href="http://sourceforge.net/projects/seedit/">http://sourceforge.net/projects/seedit/</a>から入手します。<br>

















<br>

















(1) 単純化ポリシコンパイラ（必須）<br>

















- <a href="http://prdownloads.sourceforge.net/seedit/seedit-converter-1.2.0-1.i386.rpm?download">seedit-converter-1.2.0-1.i386.rpm</a><br>

















<br>

















(2) 単純化ポリシサンプル（必須)<br>

















ディストリビューションによってダウンロードするファイルが違います <br>

















- <a href="http://prdownloads.sourceforge.net/seedit/seedit-policy-1.2.0-FC4.noarch.rpm?download">seedit-policy-1.2.0-FC4.noarch.rpm</a> (Fedora Core4用）<br>

















- <a href="http://prdownloads.sourceforge.net/seedit/seedit-policy-1.2.0-AX2.noarch.rpm?download">seedit-policy-1.2.0-AX2.noarch.rpm</a> (Asianux2.0用）<br>

















- <a href="http://prdownloads.sourceforge.net/seedit/seedit-policy-1.2.0-TL10S.noarch.rpm?download">seedit-policy-1.2.0-TL10S.noarch.rpm</a> (TurboLinux10 Server用）<br>

















<br>

















(3) GUI（オプション）<br>

















GUIを使いたい人はダウンロードします<br>

















- <a href="http://prdownloads.sourceforge.net/seedit/seedit-gui-1.2.0-1.noarch.rpm?download">seedit-gui-1.2.0-1.noarch.rpm</a><br>

















<br>

















(4)ドキュメント（オプション）<br>

















自分のマシンにドキュメントを持っておきたい人はダウンロードします。<br>

















- <a href="http://prdownloads.sourceforge.net/seedit/seedit-doc-1.2.0-1.noarch.rpm?download">seedit-doc-1.2.0-1.noarch.rpm</a><br>

















<br>

















2.2　単純化ポリシをインストールする<br>

















まず，seedit-converter, seedit-policyをインストールします。<br>

















# rpm -ivh seedit-converter*.rpm&nbsp; seedit-policy*.rpm<br>

















# rpm -ivh seedit-doc*.rpm<br>

















<br>












/etc/selinux/seedit以下に，単純化ポリシーがインストールされます。<br>























この際，/etc/selinux/configが<br>























SELINUX=permissive<br>























SELINUXTYPE=seedit<br>


















のように書き換えられてます。<br>

















<br>

















2.3 GUIをインストールする（オプション）<br>

















GUIを使いたい人は，ここでGUIをインストールします。<br>

















GUIを使わない場合は２．４に進んでください。<br>

















<br>

















(1) Webminのインストール<br>
-&nbsp; perl-Net-SSLeayのインストール(Fedora Core4の場合）<br>























# yum install perl-Net-SSLeay<br>























perl-Net-SSLeayがfedora-extraからインストールされます。<br>























- WebminのRPMパッケージを入手<br>

















<a href="http://www.webmin.com/">http://www.webmin.com/</a> から入手します。<br>
Miracle Linuxの場合はDeveloper's CDに添付されています。<br>

















- Webmin,GUIのインストール<br>

















# rpm -ivh seedit-gui*.rpm webmin*.rpm<br>












※GUIを，webminのメニューからインストールしたい場合は，seedit-gui-1.2.0.wbmファイルを使います。<br>

















<br>

















2.4 インストール後の後始末<br>

















(1) リブートします。<br>






















再起動時，全ファイルのラベル付けが行われるため多少時間がかかります。<br>












※　<span style="text-decoration: underline;">TurboLinux10Server</span>の注意：ラベル付けは行われません。ログイン後，#fixfilres restore　とします。<br>












<br>












(2) 再度リブート<br>
















この状態だと，ドメインがまともに割り当てられていません。すぐリブートします。<br>
















<br>



















(3) &nbsp;ファイルのタイプラベルを修復します<br>












# restorecon -R /etc /tmp /dev &nbsp;<br>






(<span style="text-decoration: underline;">※turbolinux 10 server</span>の場合<br>






# cd  /etc/selinux/seedit/src/policy<br>






# ./restorecon -R /etc /tmp /dev<br>






)<br>















# cd /etc/selinux/seedit/src/policy<br>



















# make diffrelabel<br>



















とします。<br>



















初回起動時は,SELinuxのタイプラベルがうまくつかないことがあるためです。<br>


















エラーメッセージが出ますが，無害なので無視します。<br>

















<br>

















(4) 再度リブートします<br>

















これでインストール完了です。<br>

















ちなみに，この段階ではpermissiveモードです。<br>












<br>












<big style="text-decoration: underline;"><big>3.動作確認<br>












</big></big>




(1) /etc/selinux/config に以下の2行が出ていることを確かめます<br>























SELINUX=permissive<br>























SELINUXTYPE=seedit<br>























<br>























(2) sestatusコマンドの出力が以下のようになっていることを確認します<br>























# sestatus <br>























SELinux status: enabled<br>























...<br>























Policy from config file: seedit<br>























...<big style="text-decoration: underline;"><big></big></big><br>













<br>

















(3) GUIの動作確認（GUIをインストールしている場合のみ）<br>

















# /etc/init.d/webmin stop<br>

















# /etc/init.d/webmin start<br>

















とし，<br>

















https://&lt;ホスト名&gt;:10000/<br>

















で，アクセスし，<br>

















ユーザ名：「root」，パスワード「&lt;rootのパスワード＞」<br>

















でログインします。<br>

















<br>

















言語を日本語に切り替えるには<br>

















Webmin Configuration&rarr;Languageと進み，「Display in Lanugage」を「Japanese（Ja.euc)」<br>

















に切り替え「Apply」を押します。<br>

















<br>

















SELinuxの管理画面は，「システム」メニューの中にあります。<br>

















SELinuxの管理画面が表示されることを確認しましょう。<br>

















<br>

















なお，実運用時には，Webminの利用には細心の注意を払います。<br>

















なぜなら，パスワードを破られたら終わりですし，<br>

















Webminは大きな権限を持つので，<br>

















webminにセキュリティホールがあった場合の被害が大きくなるからです。<br>

















パケットフィルタリングを適切に行ったり，<br>

















場合によっては，管理専用のNICを設けるなどの工夫も必要かもしれません。<br>

















<br>























(4) enforcingモードに切り替え動作確認<br>

















enforcingモードに切り替えて動作確認します。<br>

















# setenforce 1<br>











enforcingモードでアプリケーションが動作せず，permissiveモードで動作したなら，<br>











ポリシーが足りません。その際はポリシーの編集が必要になります。<br>

















<br>























(5) ポリシーを編集<br>






















ポリシーが用意されていないアプリケーションを動作させる場合や<br>

















（ドメインが「initrc_t」となっているアプリケーションは，ポリシが用意されてません）<br>

















うまく動作しない場合は単純化ポリシーを編集します。<br>






















単純化ポリシーを直接手で編集する場合は，"<a href="http://seedit.sourceforge.net/doc/simplified_policy_manual_ja/index.html">Configuring SELinux by Simplified Policy</a>（日本語）"を参照して下さい。<br>






















GUIを使う場合は<a href="http://seedit.sourceforge.net/doc/manual/index.html">GUIのマニュアル</a>,<a href="http://seedit.sourceforge.net/doc/tutorial/ja/tutorial.htm">チュートリアル</a>を参照して下さい。<br>






















<br>











もう十分だと思ったら，ブート時からenforcingモードにします<br>






















/etc/selinux/configを以下のようにします。<br>























SELINUX=enforcing<br>























SELINUXTYPE=seedit<br>

















なお，enforcingモードでのブートに失敗することがあれば，<br>

















GRUBのブートパラメータに「seilnux=0」と入れればpermissiveモードで起動できます。<br>










<br>









<span style="text-decoration: underline;">補足：ログイン時のロールについて</span><br style="text-decoration: underline;">









FC4, Turbo Linux10 Server用には，RBACの設定がされており，ログインユーザ毎にロールを割り当てるようになっています。<br>









以下の３つのロールがあります。<br>









（注：Asianux2用のポリシでは，グラフィカルログインの都合上，RBACが省いてあります。ログインユーザのユーザシェルのドメインは「unconfined_t」というSELinuxのアクセス制御が利かないドメインになってます。）<br>









1) sysadm_r: システム管理用のロール。何でもできる。ユーザ名rootでログインした場合に利用可。デフォルトでは，sshログインから直接sysadm_rにはなれないようになっている。<br>









2) staff_r: <span style="text-decoration: underline;">suコマンドを利用出来るロール</span>。su &lt;sysadm_rを使えるユーザ＞とすると，sysadm_rロールになれる。デフォルトではrootユーザのみが使える。<br>









3) user_r: 一般ユーザ向けロール。<span style="text-decoration: underline;">suコマンドの利用ができない。</span>一般ユーザのデフォルトロール。<br>









これでは設定が厳しすぎる，というのであれば，<br>









sysadm_r.aファイルの<br>









user root<br>









という行を削除し<br>









user user_u<br>









とすれば，全てのユーザからsysadm_rでログインできるようになります。<br>









一般ユーザがsuコマンドを使えるようにするには，<br>









staff_r.aファイルの<br>









user root;<br>









という行を<br>









user user_u；<br>









とし，<br>









user_r.aファイルの<br>









user user_u;<br>









という行を<br>









user dummyuser;<br>









とダミーのユーザ名に置き換えます。<br>









なおこれらのファイルを編集した後は<br>









/etc/selinux/seedit/src/policy ディレクトリにて<br>









#make diffrelabel<br>









とし設定を反映します。<br>








※Turbo Linux10 Serverについての注意<br>








TurboLinux10Serverのデフォルトでは，suでロールの切り替えを行うようになってません。<br>








ロールの切り替えをするようにするには，/etc/pam.d/suの<br>








#session optional pam_selinux.so<br>








という行の先頭の「＃」を外します。<br>









<br>












<big style="text-decoration: underline;"><big>4. アンインストール</big></big><span style="text-decoration: underline;"></span><br style="text-decoration: underline;">












# rpm -e seedit-converter seedit-policy seedit-gui seedit-doc<br>




















とし再起動するだけで，次回はpermissiveモード，targetedポリシで起動します。<br>


















つまり、/etc/selinux/configが<br>


















SELINUX=permissive<br>























SELINUXTYPE=seedit<br>


















のようになります。<br>


















targetedポリシで起動したらもう一度リブートすることをお奨めします。<br>




















<br>























<br>























<br>























</body>
</html>
