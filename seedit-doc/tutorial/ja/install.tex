\documentclass{article}
\usepackage[dvipdfm]{graphicx}
\title{SELinux Policy Editor(seedit)インストールガイド 2.0}
\author{中村　雄一\thanks{himainu-ynakam@miomio.jp}}
\begin{document}
\def\labelenumi{(\theenumi)}
\maketitle
\tableofcontents
\newpage

このドキュメントは、SELinux Policy Editorのインストール方法を解説してい
ます。

\section{動作環境}
Fedora Core5およびCent OS 4.3での動作を確認しています。
開発は、Fedora Core5ベースで行っています。


\section{RPMから導入}  \label{sec:rpm}

RPMパッケージを使うことで簡単にインストールできます
\begin{enumerate}
 \item  必要なパッケージ\\
checkpolicy,auditパッケージが必要です。以下でインストールしておきます
	(CentOSではデフォルトで入っています)。
\begin{verbatim}
# yum install checkpolicy audit
\end{verbatim}


    \item ファイルを入手\\
以下より、seedit-converter,seedit-policy,seedit-doc, seedit-guiパッケー
	ジを入手します。	
X Window Systemが入ってない場合は、seedit-guiはダウンロードしません。
\begin{verbatim}
http://selpe.sourceforge.jp/download_jp.html
\end{verbatim}

ファイル名は、
seedit-converter-2.0.0.(ディストリビューション
	  名).i386.rpm, seedit-policy-2.0.0-(ディストリビューション
	  名).i386.rpm, seedit-gui-2.0.0-1.noarch.rpm,seedit-doc-2.0.0-1.noarch.rpmとなってます。\\

seedit-converterには、Simplified PolicyをSELinuxのポリシに変換するツールと、Simplified
	  Policy管理ツールが同梱されています。seedit-policyには、
	  simplified policyが格納されています。seedit-guiは、GUIです。

 \item rpmパッケージをインストール\\
入手したrpmパッケージを以下のようにインストールし,リブートします。
\begin{verbatim}
$ su  - 
# rpm -ivh seedit-*.rpm
# reboot
\end{verbatim}
 \item 初期化\\ \label{item:init}
再起動時、ファイルのラベルが自動的に付与され直しされます。数分かかります。
	その後、リブートされます。
Fedora Core 5の場合、さらにもう一度リブートがかかります(途中で画面が青くなっても問題はありません)。
%%2度リブートが走る。
無事ログイン
	  できたら、完了です。\\
なお、auditdサービスが起動するようになっています。これは詳細なSELinuxの
	ログを/var/log/audit/audit.logに取ることができ、ポリシ自動生成機
	能をより便利に使うために必要ですので、このサービスは有効にしておくことを強く薦めます。

\item CentOS 4の注意点\\ 
CentOS 4のSELinuxパッケージに含まれるラベル初期化コマンド(fixfiles)のバ
	グにより、初期化がうまくいかないことがあります。
具体的には、「今までにstrcitポリシーを使ったことがある」または「RBACを有
	効にしたことがある」場合は、以下のコマンドで初期化する必要があり
	ます。
\begin{verbatim}
# setfiles /etc/selinux/seedit/contexts/files/file_contexts  / -F -vv
# reboot
\end{verbatim}


 \item インストールは終わりです\\
インストールされているか確認するには、\ref{sec:makesure}章を参照してくだ
	さい。



\item アンインストール方法\\
アンインストールは簡単です。
\begin{verbatim}
# rpm -e seedit-policy seedit-converter	
# reboot
\end{verbatim}
再起動時、SELinuxのtargeted policy(Fedora Coreデフォルト)の、permissive
	  モードで起動します。
\end{enumerate}

\section{ソースからのインストール方法}
\begin{enumerate}
 \item ファイル入手\\
 seedit-converter-2.0.0.tgz and seedit-policy-2.0.0.tgz,seedit-gui-2.0.0.tgzを以下からダウン
       ロードします。
\begin{verbatim}
http://sourceforge.net/project/showfiles.php?group_id=135756	
\end{verbatim}
 \item コンパイルとインストール\\
\begin{verbatim}
# tar czvf seedit-*.tgz
# cd seedit-converter
# make install DISTRO=(FC5またはCOS4)
# cd .. 
# cd seedit-policy
# make install DISTRO=(FC5またはCOS4)
# cd ..
# cd seedit-gui
# make install
# touch /.autorelabel
# reboot
\end{verbatim}

\item 初期化
ログインしたら、以下のコマンドで初期化作業を行います。
\begin{verbatim}
#restorecon -R /etc
#seedit-load -v
#chkconfig auditd on
#/etc/init.d/auditd start
#reboot	
\end{verbatim}
seedit-loadコマンドは、SPDLで書かれたポリシ(Simplified Policy)を、 SELinuxのポリシに変換し、カーネルに読み込ませたり、ファイルと タイプの関連付けを直したりするコマンドです。このコマンドを入力 することで、自分 のシステムに合わせたポリシを生成してくれます（このコマンドを入 力する前は、rpmパッケージ開発者の環境に適したポリシが生成され てます。）
 \item アンインストール\\
次のようにして、Fedora Coreデフォルトの状態に戻ることができます。
/etc/selinux/configを以下のように編集します。
\begin{verbatim}
SELINUXTYPE=seedit
-->
SELINUXTYPE=targeted
\end{verbatim}
次のコマンドを入力し、再起動します。 
\begin{verbatim}
#touch /.autorelabel
#reboot	
\end{verbatim}


\end{enumerate}

\section{何が影響されるか？}
インストールによって、
/etc/selinux/configが以下のように編集されます。
\begin{verbatim}
SELINUX=permissive	
SELINUXTYPE=seedit
\end{verbatim}
それ以外は、既存のシステムに影響を及ぼしません。

\section{動作確認}\label{sec:makesure}
seeditが正しくインストールされているか否かは、GUIおよびコマンドラインか
ら確認可能です。

\subsection{GUIで動作確認}
Gnomeのメニューから、デスクトップ $\rightarrow$ 管理 $\rightarrow$ SELinux
Policy Editor、を選択します。rootユーザーのパスワードを入力すると、図 \ref{fig:controlpanel}のような画面が現れます。
\begin{figure}
\caption{SELinux Policy Editor コントロールパネル}\label{fig:controlpanel}
\includegraphics*{images/controlpanel.png}
\end{figure}
ここから、
 {\it ステータス}を選択すると、図 \ref{fig:status-selinux}のような画面が
 現れます。{\it seeditがインストールされている？　はい}と表示されればイ
 ンストールは成功です。

\begin{figure}
\caption{Status}\label{fig:status-selinux}
\includegraphics{images/status-selinux.png}
\end{figure}




\subsection{コマンドラインで動作確認}
次のような出力になれば成功です。
\begin{verbatim}
# sestatus
SELinux status:                 enabled
Current mode:                   permissive
Mode from config file:          permissive
...
Policy from config file:        seedit
\end{verbatim}
「Policy from config file:        seedit」となってます。

\subsection{次は何をする？}

どうやって設定をしていくかの詳細は「SELinux Policy Editor管理ガイ
ド（マニュアル）」を参照してください。
また、インストール直後は、Permissiveモードになっていることに気を付けます。
Permissiveモードでは、SELinuxはシステムを守ってくれません。実運用時はど
うするかについても、管理ガイドに載っています(Enforcingモードに切り替えま
す)。
\end{document}
