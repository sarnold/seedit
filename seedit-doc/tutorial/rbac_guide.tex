\documentclass{article}
\title{SELinux Policy Editor(seedit) RBAC guide (for Ver 2.0))}
\author{Yuichi Nakamura \thanks{ynakam@gwu.edu}}
\begin{document}
\def\labelenumi{(\theenumi)}
\maketitle
\tableofcontents
\newpage


\section{What is RBAC}
SPDL supports configuration of RBAC(Role Based Access Control).
In default policy, the domain for login user is unconfined\_t.
So, the behavior of user is not confined by SELinux.\\

To increase security of login user, RBAC is useful.

xxxxx

\section{Enable RBAC}
To enable RBAC, use following command.
\begin{verbatim}
# seedit-rbac on
(It takes some minutes)
# reboot
\end{verbatim}
By above commands, files necessary to configure RBAC is moved from
/etc/seedit/policy/extra to /etc/seedit/policy, and seedit-load is
run.Reboot is necessary because some domains become invalid, to fix this
you have to reboot.\\

To disable RBAC, use following.
\begin{verbatim}
# seedit-rbac off
# reboot
\end{verbatim}

\section{Default RBAC Configuration}
Following 3 roles are defined by default.

\begin{itemize}
 \item sysadm\_r\\
       It is role for administrator. It can work as unconfined
       domain sysadm\_t. By default, only root can login as the role.
 \item staff\_r \\
       It is role, to do not administrative work for administrative
       user.
       By default, only root can login as the role.
 \item user\_r \\
       It is a role for normal users. By default, user\_u can login as
       root.
       user\_u is a user that is not configured RBAC, by default users
       except root.
       
\end{itemize}

Attention!!\\
{\it su command can not be used, except sysadm\_r}.


\section{Login by RBAC}
\subsection{Check role}
When you enable RBAC, role are given to login user. 
You can see it by id command.\\
When you login as root user,  staff\_r role is given.\\
Let's see it by id command.
\begin{verbatim}
# id 
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),
3(sys),4(adm),6(disk),10(wheel) 
context=root:staff_r:staff_t
\end{verbatim}
\begin{verbatim}
context=root:staff_r:staff_t	
\end{verbatim}
shows role, staff\_r is role. User shell is given domain according to
role, in this case staff\_t. Inside SELinux, domain is used for access
control.\\
staff\_r is given little access rights. You can not do any
administration work in this role.\\
For example, you can not access homepage.
\begin{verbatim}
# cat /var/www/html/index.html
Permission denied
\end{verbatim}

\subsection{Change role}
To do administrative work, you have to switch role to sysadm\_r role.
You can do it by newrole command, like below.
\begin{verbatim}
# newrole -r sysadm_r
Authenticating root
Password:
\end{verbatim}
You have to enter password of current user(this case root).
Then check role by id command.
\begin{verbatim}
# id 
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),
3(sys),4(adm),6(disk),10(wheel) 
context=root:sysadm_r:sysadm_t
\end{verbatim}
Role is  sysadm\_r. Domain of user shell is sysadm\_t. sysadm\_t is
unconfined domain, so you can do any work.\\
To switch role, the user must be allowed to use the role, if the user is
not allowed to use the role, newrole will fail.\\
To allow user to use role, see next section.

\section{Creating new role}
The best way to understand RBAC is to create  new role. Let's see it by
example.
Here, we will create new role for webmaster, the name is webmaster\_r.
\subsection{Create uid=0 user}

\begin{verbatim}
# useradd -u 0 -o webmaster
# passwd webmaster
\end{verbatim}

\subsection{Create template}
You can create template configuration by seedit-template command.\\
The usage is following.
\begin{verbatim}
seedit-template -r <role> -u <user>
\end{verbatim}



%%restorecon を使えるようにするとか allowpriv part_relabel


\end{document}